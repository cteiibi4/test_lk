{"ast":null,"code":"import axios from \"axios\";\nimport settings from \"./settings\";\nconst requests = axios.create();\nrequests.interceptors.request.use(async config => {\n  config.defaults.headers = {\n    'Authorization': `Bearer ${localStorage.getItem('access')}`,\n    'Accept': 'application/json',\n    'Content-Type': 'application/x-www-form-urlencoded'\n  };\n  config.defaults.headers.post = {\n    'Content-Type': 'application/json'\n  };\n  config.baseURL = settings.base_url;\n  return config;\n}, error => {\n  Promise.reject(error);\n});\nrequests.interceptors.response.use(response => {\n  return response;\n}, async function (error) {\n  const originalRequest = error.config;\n  if (error.response.status === 401 && !originalRequest._retry) {\n    originalRequest._retry = true;\n    var access_token = await refreshAccessToken();\n    if (access_token === true) {\n      axios.defaults.headers.common['Authorization'] = localStorage.getItem('access');\n      return requests(originalRequest);\n    }\n  }\n  return Promise.reject(error);\n});\nasync function refreshAccessToken() {\n  let answer = false;\n  let url = settings.base_url + \"/api/users/login/token-refresh/\";\n  const data = {\n    refresh: localStorage.getItem('refresh')\n  };\n  const instatnce = axios.create({\n    headers: {\n      'Accept': 'application/json'\n    }\n  });\n  instatnce.post(url, data).then(result => {\n    localStorage.setItem('access', result.data.access);\n    answer = true;\n  }).catch(error => {\n    localStorage.setItem('access', '');\n    localStorage.setItem('refresh', '');\n  });\n  return answer;\n}\nexport default requests;","map":{"version":3,"names":["axios","settings","requests","create","interceptors","request","use","config","defaults","headers","localStorage","getItem","post","baseURL","base_url","error","Promise","reject","response","originalRequest","status","_retry","access_token","refreshAccessToken","common","answer","url","data","refresh","instatnce","then","result","setItem","access","catch"],"sources":["/home/paycon-1/kso-lk-managment/reactapp/src/requests.js"],"sourcesContent":["import axios from \"axios\";\nimport settings from \"./settings\";\n\nconst requests = axios.create();\n\nrequests.interceptors.request.use(\n  async config => {\n    config.defaults.headers = {\n      'Authorization': `Bearer ${localStorage.getItem('access')}`,\n      'Accept': 'application/json',\n      'Content-Type': 'application/x-www-form-urlencoded'\n    }\n    config.defaults.headers.post = {\n      'Content-Type': 'application/json'\n    }\n    config.baseURL = settings.base_url;\n    return config;\n  },\n  error => {\n    Promise.reject(error)\n  });\n\nrequests.interceptors.response.use((response) => {\n  return response\n}, async function (error) {\n  const originalRequest = error.config;\n  if (error.response.status === 401 && !originalRequest._retry) {\n    originalRequest._retry = true;\n    var access_token = await refreshAccessToken();\n\n    if (access_token === true) {\n      axios.defaults.headers.common['Authorization'] = localStorage.getItem('access');\n      return requests(originalRequest);\n    }\n  }\n  return Promise.reject(error);\n});\n\nasync function refreshAccessToken() {\n  let answer = false;\n  let url = settings.base_url + \"/api/users/login/token-refresh/\";\n  const data = {\n    refresh: localStorage.getItem('refresh')\n  };\n  const instatnce = axios.create({\n    headers: {\n      'Accept': 'application/json',\n    }\n  });\n\n  instatnce.post(url, data)\n    .then((result) => {\n      localStorage.setItem('access', result.data.access);\n      answer = true;\n    })\n    .catch((error) => {\n      localStorage.setItem('access', '')\n      localStorage.setItem('refresh', '')\n    })\n  return answer\n}\n\nexport default requests"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,QAAQ,MAAM,YAAY;AAEjC,MAAMC,QAAQ,GAAGF,KAAK,CAACG,MAAM,CAAC,CAAC;AAE/BD,QAAQ,CAACE,YAAY,CAACC,OAAO,CAACC,GAAG,CAC/B,MAAMC,MAAM,IAAI;EACdA,MAAM,CAACC,QAAQ,CAACC,OAAO,GAAG;IACxB,eAAe,EAAG,UAASC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAE,EAAC;IAC3D,QAAQ,EAAE,kBAAkB;IAC5B,cAAc,EAAE;EAClB,CAAC;EACDJ,MAAM,CAACC,QAAQ,CAACC,OAAO,CAACG,IAAI,GAAG;IAC7B,cAAc,EAAE;EAClB,CAAC;EACDL,MAAM,CAACM,OAAO,GAAGZ,QAAQ,CAACa,QAAQ;EAClC,OAAOP,MAAM;AACf,CAAC,EACDQ,KAAK,IAAI;EACPC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AACvB,CAAC,CAAC;AAEJb,QAAQ,CAACE,YAAY,CAACc,QAAQ,CAACZ,GAAG,CAAEY,QAAQ,IAAK;EAC/C,OAAOA,QAAQ;AACjB,CAAC,EAAE,gBAAgBH,KAAK,EAAE;EACxB,MAAMI,eAAe,GAAGJ,KAAK,CAACR,MAAM;EACpC,IAAIQ,KAAK,CAACG,QAAQ,CAACE,MAAM,KAAK,GAAG,IAAI,CAACD,eAAe,CAACE,MAAM,EAAE;IAC5DF,eAAe,CAACE,MAAM,GAAG,IAAI;IAC7B,IAAIC,YAAY,GAAG,MAAMC,kBAAkB,CAAC,CAAC;IAE7C,IAAID,YAAY,KAAK,IAAI,EAAE;MACzBtB,KAAK,CAACQ,QAAQ,CAACC,OAAO,CAACe,MAAM,CAAC,eAAe,CAAC,GAAGd,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC;MAC/E,OAAOT,QAAQ,CAACiB,eAAe,CAAC;IAClC;EACF;EACA,OAAOH,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AAC9B,CAAC,CAAC;AAEF,eAAeQ,kBAAkBA,CAAA,EAAG;EAClC,IAAIE,MAAM,GAAG,KAAK;EAClB,IAAIC,GAAG,GAAGzB,QAAQ,CAACa,QAAQ,GAAG,iCAAiC;EAC/D,MAAMa,IAAI,GAAG;IACXC,OAAO,EAAElB,YAAY,CAACC,OAAO,CAAC,SAAS;EACzC,CAAC;EACD,MAAMkB,SAAS,GAAG7B,KAAK,CAACG,MAAM,CAAC;IAC7BM,OAAO,EAAE;MACP,QAAQ,EAAE;IACZ;EACF,CAAC,CAAC;EAEFoB,SAAS,CAACjB,IAAI,CAACc,GAAG,EAAEC,IAAI,CAAC,CACtBG,IAAI,CAAEC,MAAM,IAAK;IAChBrB,YAAY,CAACsB,OAAO,CAAC,QAAQ,EAAED,MAAM,CAACJ,IAAI,CAACM,MAAM,CAAC;IAClDR,MAAM,GAAG,IAAI;EACf,CAAC,CAAC,CACDS,KAAK,CAAEnB,KAAK,IAAK;IAChBL,YAAY,CAACsB,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC;IAClCtB,YAAY,CAACsB,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;EACrC,CAAC,CAAC;EACJ,OAAOP,MAAM;AACf;AAEA,eAAevB,QAAQ"},"metadata":{},"sourceType":"module","externalDependencies":[]}